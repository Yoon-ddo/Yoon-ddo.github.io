---
title: Spring 공부 전 기초
toc: true
toc_sticky: true
toc_label: "Contents of Page"
categories:
  - Study
tags:
  - Spring_Study
---

<br><br>

# 학습목표 : Spring을 이해하기 위해 하드코딩으로 Spring처럼 만들어보기
* bean.properties 파일을 만들지 않아도 된다.


## 1. Annotation이란?
* 프로그램 실행 중 해당 변수에 대해 속성을 설정해주는 역할을 함.(Override, ...)
* 주석에 대한 역할을 하면서 문법으로 체크함.
* @Override, @WebServlet(value=".do") ...

### 1-1. Annotation만들기
#### 1. New-> Annotation (원하는 패키지, 원하는 파일명 )

#### 2. String value(); 메소드 선언 
* @RequestMapping(value="list.do") // value()로 "list.do"를 추출할 수 있음
* String uri();를 선언하면 @RequestMapping(uri="list.do")가 됨

#### 3. @Target(ElementType.)
* Annotation을 어디에 붙일지 설정할 수 있음
* 종류
  - `@Target(ElementType.METHOD)` : 메소드 위에 붙일 수 있음
  - `@Target(ElementType.TYPE)` : 클래스위에 붙일 수 있음
  - `@Target(ElementType.FIELD)` : 멤버변수 위쪽에 붙일 수 있음

#### 4. @Retention(RetentionPolicy.RUNTIME)
* Annotation 정보를 언제까지 유지시킬지 지정
* `RUNTIME` : 프로그램 실행되는동안까지

#### 5. new Instance한 후, 메소드까지 실행하게 설정
* DispatcherServlet 에서 `@WebServlet("*.do")` 주석처리후
* web.xml설정

```xml
  <servlet>
  	<servlet-name>dispatcherServlet</servlet-name>
  	<servlet-class>kr.ac.kopo.framework.DispatcherServlet</servlet-class>
  <init-param>
  	<param-name>controllers</param-name>
  	<param-value>kr.ac.kopo.board.controller.BoardController
  				kr.ac.kopo.login.controller.LoginController</param-value>
  </init-param>
  </servlet>
  
   <servlet-mapping>
  	<servlet-name>dispatcherServlet</servlet-name>
  	<url-pattern>*.do</url-pattern>
  </servlet-mapping>
```

#### 6. CtrlMethod 
* list.do    -> BoardController --> list()
* 어떤 컨트롤러인지 어떤메소드인지 받는 클래스 (get메소드만 필요)

```java
import java.lang.reflect.Method;

public class CtrlAndMethod {
	
	private Object target;
	//어떤 메소드를 실행하는지 기억
	private Method method;

	public CtrlAndMethod(Object target, Method method) {
		super();
		this.target = target;
		this.method = method;
	}

	/**
	 * @return the target
	 */
	public Object getTarget() {
		return target;
	}

	/**
	 * @return the method
	 */
	public Method getMethod() {
		return method;
	}

}
```

#### 7. HandlerMapping
* 어떤 uri가 들어왔을때 어떤 메소드가 실행될지
* `import java.lang.reflect.Method;`

```java
package kr.ac.kopo.framework;

import java.lang.reflect.Method;
import java.util.Map;

public class HandlerMapping {
	
	private Map<String, CtrlAndMethod> mappings;
	//uri
	
	public HandlerMapping(String ctrlNames) throws Exception {
		//ctrlName -> kr.ac.kopo.board.controller.BoardController | kr.ac.kopo.login.controller.LoginController
		String[] ctrls = ctrlNames.split("\\|");
		for(String c: ctrls) {
			//System.out.println(c.trim()); | 뒤에 들여쓰기 공백있으니까 trim필요
			Class<?> clz = Class.forName(c.trim());
			//Object target = clz.newInstance(); // jdk 9부터 사용제한.
			Object target = clz.getDeclaredConstructor().newInstance();
			System.out.println(target);
			
			Method[] methods = clz.getMethods(); //사용할 수 있는 메소드 출력 (public만 나온다.)
			//Method[] methods = clz.getDeclaredMethods(); // 자신에 클래스에 선언한것 모두 나옴.(public, private ...)
			
			for(Method method : methods) {
				System.out.println(method);
			}
			System.out.println();
		}
	
	}
	
}
```

* DispatcherServlet

```java

	private HandlerMapping mappings; //밖에 선언
       
	/**
	 * @see Servlet#init(ServletConfig)
	 */
	public void init(ServletConfig config) throws ServletException {
		String ctrlNames = config.getInitParameter("controllers");
		System.out.println(ctrlNames);
		
		try {//init는 throws ServletException 이므로 에러남.그래서 try-catch필요
			mappings = new HandlerMapping(ctrlNames);
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
```

#### 8. 원하는 메소드 찾기
* `@RequestMapping` 어노테이션이 붙은것만 찾고싶다.
* RequestMapping reqAnno = method.getAnnotation(RequestMapping.class);
