---
title: Spring06_복습
toc: true
toc_sticky: true
toc_label: "Contents of Page"
categories:
  - Study
tags:
  - Spring_Study
---

<br><br>

* 이 게시물은 `처음 시작하는 스프링 프레임워크 - 허진경 지음` 책을 공부하며 작성한 글입니다.
  - <span style="color:lightgray">교수님! 좋은 책 주셔서 감사합니다:)</span>

# 1. DI 
## 1-1. DI
* DI를 사용하지 않는 코드는 직접 필요한 객체를 생성해서 사용해야했다.
 - HelloController.java : `IHelloService helloService = new HelloService();`
 - HelloController는 인터페이스를 이용해 기능을 사용하고 싶어도 HelloService클래스가 없다면 사용 불가. (강한 의존관계)
 - 강한 의존관계를 이루지 않도록 HelloService 클래스가 완성된 후 객체를 생성하여 HelloController클래스에게 줄 수 있음

* DI를 사용한 코드
  - `생성자 주입` : HelloController.java
    1. `IHelloService helloService;`를 멤버객체로 선언 후
    2. 생성자 주입 : `public HelloController(IHelloService helloservice){ this.helloService = helloservice; }`
    3. main에서 객체 생성시 생성자 주입
  - `Setter주입` : HelloController.java
    1. `IHelloService helloService;`를 멤버객체로 선언 후
    2. Setter주입 : `public void setHelloService(IHelloService helloservice){ this.helloService = helloservice; }`
    3. main에서 기본 생성자로 Controller객체 선언 후, .setHelloService(helloservice); 객체 전달

<br><br><br>

## 1-2. Spring DI
* 스프링의 의존성 주입?
  - 스프링 컨테이너
  - 스프링은 필요로하는 bean을 생성하여 컨테이너에서 관리한다.
  - 이때 bean을 생성하기 위한 설정과 의존객체를 주입시키기 위한 설정이 필요하다.
* 종류
  - XML을 이용한 DI
  - Annotation을 이용한 DI 

<br><br>

### 1-2-1. XML 이용한 DI
* 생성자를 이용한 의존성 주입
* setter 메소드를 이용한 의존성 주입

#### 00. 시작 전, 설정하기
  - `src/main/resources`에서 Spring Bean Configuration File 생성 ( = xml 파일생성)
  - bean설정
    + name / id : 고유 식별자 지정.
    + class : 필수속성, Bean작성하는데 사용할 클래스. `패키지이름.클래스이름`
    + scope : 객체 범위 (prototype(요청할때마다 새로운객체 생성), singleton(bean이 항상 하나만 생성), request, session (WebApplicationContext사용시 적용))
    + lazy-init : bean이 사용되는 시점에 인스턴스 생성 (true / false)
    + destroy-method : bean삭제 직전 지정한 메소드 실행

#### 01. Spring Context
  - 객체를 생성하고 관리하는 컨테이너 기능
  - BeanFactory 인터페이스를 구현한 클래스
    + Lazy Loading방식 : 클라이언트 요청시 bean생성
    + 설정파일에 등록된 bean을 생성하고 관리하는 기본적인 컨테이너 기능만 제공
  - ApplicationContext 인터페이스를 구현한 클래스
    + Pre Loading방식
    + bean을 생성하고 관리하는 기능 외에 트랜잭션 관리, 국제화 처리 등 많은 기능 제공. 
    + FileSystemXmlApplicationContext : 파일 시스템 경로의 xml설정 파일을 로딩
    + ClassPathXmlApplicationContext : 클래스 패스 경로에 있는 xml설정 파일 로딩
    + GenericXmlApplicationContext : 파일 시스템 경로의 xml, 클래스 패스 경로의 xml 파일 로딩 (클래스패스 경로 시 `classpath:` 접두어 붙인다.)
    + XmlWebApplicationContext : 웹 애플리케이션 개발에 사용되지만 직접 생성하지 않는 Context

```java
AbstractApplicationContext context = new GenericXmlApplicationContext("application-config.xml");
context.close();
```

<br><br>

#### 02. 생성자 주입
* Controller 클래스에 IHelloService helloService; 인터페이스 객체 멤버변수 선언후 이에 객체를 주입하는 생성자 추가.
* 스프링 설정 파일에 `<constructor-arg>`태그로 의존성 주입
  - ref속성으로 의존성 주입할 다른 bean 아이디 지정 
  - <constructor-arg ref="helloService"/>

```xml
<bean id="helloService" class="패키지명.HelloService(클래스명)"/>
<bean id="helloController" class="패키지명.HelloController">
   <constructor-arg ref="helloService"/>
</bean>
```

<br>

* 생성자의 인자로 전달하는 인자의 type이 문자열이거나 기본 데이터 타입일 경우 value속성 이용

```xml
<constructor-arg value="oracle.jdbc.driver.OracleDriver" />
<constructor-arg value="jdbc:oracle:thin:@localhost:1521:xe" />
```

<br>

* index속성 지정도 가능.

```xml
<constructor-arg index="1" value="oracle.jdbc.driver.OracleDriver" />
<constructor-arg index="0" value="jdbc:oracle:thin:@localhost:1521:xe" />
```

<br>

* 인자로 전달하는 객체가 null일 경우 

```xml
<constructor-arg>
  <null/>
</constructor-arg>
```

<br><br>

#### 03. Setter메소드 주입
* Controller 클래스에 IHelloService helloService; 인터페이스 객체 멤버변수 선언후 이에 객체를 주입하는 Setter 메소드 추가.
* 스프링 설정파일에서 `<property>`태그를 이용하여 의존 객체 주입 <span style="color:red">( 기본 생성자 외에 다른 생성자 정의 금지 )</span>
  - name : 의존성을 주입할 bean의 고유 이름
  - ref : 의존성을 주입할 객체의 이름
  - value : 값을 지정

```xml
<bean id="helloService" class="패키지명.HelloService"/>
<bean id="helloController" class="패키지명.HelloController">
    <property name="helloService" ref="helloService" />
</bean>
```

<br>

* value로 string,기본데이터 타입 의존성 주입 가능

```xml
<bean id="helloController" class="패키지명.HelloController">
  <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver" />
  <property name="url" value="jdbc:oracle:thin:@localhost:1521:xe" />
</bean>
```

<br>

* p네임스페이스
  - Setter주입 사용시 p네임스페이스를 이용하여 bean 태그의 속성으로 의존성 주입 가능.
  - Namespace탭에서 `p 네임스페이스` 선택. 별도의 스키마가 없으므로, 네임스페이스만 선언하고 사용할 수 있다.
  - 의존성 주입
    + `p:변수명-ref="bean이름"`
  - string과 기본 데이터 타입
    + `p:변수명="값"`

```xml
<bean id="helloService" class="패키지명.HelloService" />
<bean id="helloController" p:helloService-ref="helloService" class="패키지명.HelloController" />
```

<br><br>

#### 04. Collection타입 의존성
* List, Set, Map, props
* 의존성 설정 태그
| 태그 | 타입 |
|:---:|:---:|
| <list> | java.util.List 또는 배열 |
| <set> | java.util.Set |
| <map> | java.util.Map |
| <props> | java.util.Properties |
  




<br><br><br><br>
