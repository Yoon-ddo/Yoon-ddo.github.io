---
title: PLSQL08_Module(Stored Block3)
toc: true
toc_sticky: true
toc_label: "Contents of Page"

categories:
  - Study
tags:
  - SQL_Study
---

<br><br>

# PACKAGE
## 1. PACKAGE 만들기
### 1-1. HEADER만들기
- HEADER영역에서 정의한 PROCEDURE, FUNCTION, VARIABLE은 `PUBLIC`이다.

```sql
CREATE OR REPLACE PACKAGE P_EMPLOYEE
AS
    -- 사원 퇴사
    PROCEDURE DELETE_EMP(P_EMPNO EMP.EMPNO%TYPE);
    
    -- 신규 입사사원 등록
    PROCEDURE INSERT_EMP(P_EMPNO NUMBER, P_ENAME VARCHAR2, P_JOB VARCHAR2, P_SAL NUMBER, P_DEPTNO NUMBER);
    
    -- MANAGER이름 리턴
    FUNCTION SEARCH_MNG(P_EMPNO EMP.EMPNO%TYPE) RETURN VARCHAR2;
    GV_ROWS NUMBER(6); -- public변수
END P_EMPLOYEE;
/
```  



### 1-2. BODY만들기
- BODY영역에서만 정의한 PROCEDURE, FUNCTION, VARIABLE은 `PRIVATE`이다.
- GV_ROWS는 참조가능하지만, V_ROWS는 에러 발생
- HEADER에 정의하면 PUBLIC이 된다. BODY에 정의되어있는데 HEADER에 없다면 그것은 PRIVATE!

```sql
CREATE OR REPLACE PACKAGE BODY P_EMPLOYEE
AS
    V_ENAME     EMP.ENAME%TYPE; -- PRIVATE
    V_ROWS      NUMBER(6);      -- PRIVATE
    
    FUNCTION PRVT_FUNC(P_NUM IN NUMBER) RETURN NUMBER IS
    BEGIN
        RETURN P_NUM;
    END PRVT_FUNC;
    
    -- 신규 입사사원 등록
    PROCEDURE INSERT_EMP(P_EMPNO NUMBER, P_ENAME VARCHAR2, P_JOB VARCHAR2, P_SAL NUMBER, P_DEPTNO NUMBER)
    IS
    BEGIN
        INSERT INTO EMP(EMPNO, ENAME, JOB, SAL, DEPTNO) VALUES(P_EMPNO, P_ENAME, P_JOB, P_SAL, P_DEPTNO);
    END INSERT_EMP;
    
    PROCEDURE DELETE_EMP(P_EMPNO EMP.EMPNO%TYPE) IS --PUBLIC PROCEDURE정의
    BEGIN
        DELETE FROM EMP WHERE EMPNO = P_EMPNO;
        COMMIT;
        --IMPLICIT CURSOR ATTRIBUTE, PUBLIC변수 참조
        GV_ROWS := GV_ROWS+SQL%ROWCOUNT;
        V_ROWS := PRVT_FUNC(GV_ROWS); -- PRIVATE FUNCTION 참조
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            WRITE_LOG('P_EMPLOYEE.DELETE', SQLERRM, 'VALUES : [EMPNO] => '||P_EMPNO);
    END DELETE_EMP;
    
    FUNCTION SEARCH_MNG(P_EMPNO EMP.EMPNO%TYPE) RETURN VARCHAR2 IS
        V_ENAME     EMP.ENAME%TYPE;
    BEGIN
        SELECT ENAME INTO V_ENAME FROM EMP
        WHERE EMPNO = (SELECT MGR FROM EMP WHERE EMPNO = P_EMPNO);
        RETURN V_ENAME;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            V_ENAME := 'NO_DATA';
            RETURN V_ENAME;
        WHEN OTHERS THEN
            V_ENAME := 'SUBSTR(SQLERRM,1,12)';
            RETURN V_ENAME;
    END SEARCH_MNG;
BEGIN
    GV_ROWS := 0; -- 초기화
END P_EMPLOYEE;
/
```



# TRIGGER
