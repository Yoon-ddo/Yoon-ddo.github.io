---
title: Reflction과 Properties
toc: true
toc_sticky: true
toc_label: "Contents of Page"

categories:
  - Study
tags:
  - Servlet_Study
---

<br><br>


# AJAX
## 1. 동기와 비동기방식
* 동기방식
  - 요청 후, 응답이 올 때까지 client는 대기만 하는 것.
* 비동기방식
  - 요청 후, 응답이 올 때까지 client가 다른 Background 작업을 할 수 있는 것.
  - client는 멈추지 않고 동작

<br><br><br>

## 2. AJAX 구성 및 특징
* JavaScript
* css
* DOM
* XMLHttpRequest
  - 자바스크립트 객체
  - 대부분의 브라우저에서 지원
  - 표준 HTTP방식(GET/POST)으로 서버와 통신
  - 서버와 통신시 비동기적으로 작업
  - 기존 서버 작업 방식 사용 (Servlet, JSP, ...)
  - 응답문서 타입 : html외에 **xml**, **json**, 단순 텍스트 사용
* client의 요청을 AJAX Engine이 가로채서 대신 요청과 응답을 Http프로토콜로 처리하는 기술


<br><br><br>

## 3. AJAX프로그래밍 순서
1. 클라이언트 이벤트 발생 (ex. 버튼클릭, 텍스트 입력...)
2. XMLHttpRequest 객체 생성
3. XMLHttpRequest 객체 콜백함수 설정 ( 서버의 상태가 바뀔때마다 호출되는 함수 )
4. XMLHttpRequest 객체를 통한 비동기화 요청
5. 서버 응답결과를 생성하여 클라이언트로 전송
6. XMLHttpRequest 객체는 서버 결과를 처리할 콜백함수 호출
7. 결과를 클라이언트 화면에 

<br><br><br>

## 4. 예제
### 4-1. ajaxTest.jsp에서 버튼을 누르면 hello.jsp의 값이 날아오게 하기
- hello.jsp

~~~html

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<h1>Hello AJAX!</h1>
  
~~~

- ajaxTest.jsp

~~~html

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<style>
	#msgView{
		border:1px solid red;
		height:200px;
		width: 500px;
		margin-bottom:20px;
		text-align:center;
	}
</style>

<script>

	let httpRequest = null
	
	function requestMsg(){
		// 1단계 : XMLHttpRequest객체 생성
		if(window.XMLHttpRequest)
			httpRequest = new XMLHttpRequest()
		else if(window.ActiveXObject)
			// explore버전때문에 해주는거임. 최소한의 안전장치
			httpRequest = new ActiveXObject("Microsoft.XMLHTTP")
		else
			httpRequest = null
	
		// 2단계 : Callback함수 설정( 서버요청이 바뀔때마다 호출되는 함수 )
		/*
			httpRequest.onreadystatechage = function(){
			
			}아래와 같은 뜻
		*/
		httpRequest.onreadystatechange = responseMsg
		
		// 3단계 : 서버에 비동기 요청
		httpRequest.open('GET', 'hello.jsp' ,true) // 비동기방식 true
		httpRequest.send(null)

	}
	
	
	function responseMsg(){
		if(httpRequest.readyState == 4){
			// 모든 데이터 전송완료(응답완료 4) 했고 결과가 올바르다면(200) responseText한다.
			if(httpRequest.status == 200){
				
				let msgView = document.getElementById("msgView");
				msgView.innerHTML = httpRequest.responseText // +=는 계속 추가됨
				
				
			}
			
		}
		
	}
	
</script>

</head>
<body>
	<h2>서버에서 받은 메시지</h2>
	<div id="msgView">
		
	</div>
	<input type="button" value="서버에서 자료 요청" onclick="requestMsg()">

</body>
</html>
  
~~~

<br>

### 4-1. 가상의 url로 넘어가게 하기.
* ajaxText2.jsp
  - 위의 ajaxText.jsp복사
  - httpRequest.open('GET', 'hello.jsp' ,true)부분 httpRequest.open('GET', '/Lecture-Web/ajax/hello',true)로 수정
* HelloServlet.java

```java
package kr.ac.kopo.ajax;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class HelloServlet
 */
@WebServlet("/ajax/hello")
public class HelloServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;

	/**
	 * @see HttpServlet#service(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html; charset=utf-8");
		
		PrintWriter out = response.getWriter();
		out.write("<h1>Hello AJAX!!!</h1>");
		out.close();
	}
}
```

<br><br><br>

## 5. GET방식과 POST방식의 파라미터 전달방법
### 5-1. GET방식
* open('GET', 'hello.jsp?id=duke', true)
* send(null)

~~~html

<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script>

	let httpRequest = null

	function getXMLHttpRequest(){
		
		let httpRequest=null
		
		if(window.XMLHttpRequest)
			httpRequest = new XMLHttpRequest()
		else if(window.ActiveXObject)
			// explore버전때문에 해주는거임. 최소한의 안전장치
			httpRequest = new ActiveXObject("Microsoft.XMLHTTP")
		return httpRequest
	}
	
	
	function sendProcess(param){
		
		httpRequest = getXMLHttpRequest()
		httpRequest.onreadystatechange = callbackFunction
		
		let msg="==================================================\n";
		msg += "/Lecture-Web/eaxm02/param.jsp?name=" + param + "\n";
		debugTrace(msg)
		
		let url = "param.jsp?name=" + param
		httpRequest.open('GET', url, true)
		httpRequest.send(null)
		
	}
	
	function callbackFunction(){
		
		let msg =''
		
		switch(httpRequest.readyState){
		case 1:
			msg += 'Loading...\n'
			break
		case 2:
			msg += 'Loaded...\n'
			break
		case 3:
			msg += 'Interaction...\n'
			break
		case 4:
			msg += 'Completed...\n'
			
			if(httpRequest.status == 200){
				msg += '웹서버에서 정상적으로 수행...\n'
				msg += '실행결과 : ' + httpRequest.responseText + '\n'
			}else{
				msg += '웹서버에서 오류 발생...\n'
				msg += '오류코드 : ' + httpRequest.status + '\n'
				
				// Explorer에서 한글인자호출시 400에러가 난다?
			}
			msg += "===================================================\n"
			break
		}
		
		debugTrace(msg)
		
	}
	
	function debugTrace(msg){
		//debug메시지 출력하는 메소드
		let degug = document.getElementById("debug")
		debug.value += msg
	}

</script>


</head>
<body>
	<textarea rows="10" cols="80" id="debug"></textarea><br>
	<button onclick="sendProcess('hong gill-dong')">영문인자호출</button>
	<button onclick="sendProcess('홍길동')">한글인자호출</button>

</body>
</html>
  
~~~

* Explorer에서 한글인자호출시 400에러가 난다?
  - 400Error : Explorer에서 한글을 인식 못해서 나오는것.
  - Chrome은 알아서 인코딩이 되지만, Explorer는 인코딩이 안되기 때문.

~~~html

  param = encodeURIComponent(param) 
  // 모든 브라우저에서 동작하기 위해서는 encode해줘야함
  let url = "param.jsp?name=" + param

~~~


			
### 5-2. POST방식
* open('POST', 'hello.jsp', true)
* send('id=duke')
