---
title: Spring07_스프링으로 게시판 구현하기
toc: true
toc_sticky: true
toc_label: "Contents of Page"
categories:
  - Study
tags:
  - Spring_Study
---

<br><br>

# 0. 구현하기 전
## uri 축소하기
* REST방식의 uri는 `method + uri`로 구성되어 있다.
* POST방식은 테이블 기반으로 살펴보았을 때, 일반적으로 정보를 등록하겠다는 의미가 강하다.
* 기존의 URI가 `/board/selectOne.do?no=?`일때 Spring 방식의 URI는 `/board?no=5` 또는 `/board/5`
  - GET - 조회
  - POST - 수정
  - DELETE - 삭제

## REST는 왜쓹까?
* URI로 내 정보를 전달하기 위해 사용.
* 분산서버에서 많이 씀



<br><br>

# 1. 환경설정
* Maven Project생성

## pom.xml

```xml
<dependencies>
  <!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc -->
  <dependency>
     <groupId>org.springframework</groupId>
     <artifactId>spring-webmvc</artifactId>
     <version>5.3.9</version>
  </dependency>

   <!-- https://mvnrepository.com/artifact/javax.servlet.jsp/javax.servlet.jsp-api -->
  <dependency>
     <groupId>javax.servlet.jsp</groupId>
     <artifactId>javax.servlet.jsp-api</artifactId>
     <version>2.3.3</version>
     <scope>provided</scope>
  </dependency>

   <!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api -->
  <dependency>
     <groupId>javax.servlet</groupId>
     <artifactId>javax.servlet-api</artifactId>
     <version>4.0.1</version>
     <scope>provided</scope>
  </dependency>

</dependencies>
```

## config/spring/spring-mvc.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans   
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context   
    http://www.springframework.org/schema/context/spring-context.xsd
    http://www.springframework.org/schema/mvc
    http://www.springframework.org/schema/mvc/spring-mvc.xsd">

	<context:component-scan base-package="kr.ac.kopo" />
    <mvc:annotation-driven />
	<mvc:default-servlet-handler />
	<mvc:view-resolvers>
		<mvc:jsp prefix="/WEB-INF/jsp/" suffix=".jsp" />
	</mvc:view-resolvers>

</beans>
```

## webapps/WEB-INF/web.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" id="WebApp_ID" version="3.0">
  <display-name>spring-mvc</display-name>
  
  <servlet>
  	<servlet-name>dispatcher</servlet-name>
  	<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
  	<init-param>
  		<param-name>contextConfigLocation</param-name>
  		<param-value>
  			classpath:config/spring/spring-mvc.xml
  		</param-value>
  	</init-param>
  	<load-on-startup>1</load-on-startup>
  </servlet>
  
  <servlet-mapping>
  	<servlet-name>dispatcher</servlet-name>
	<url-pattern>/</url-pattern>  
  </servlet-mapping>
  
  <filter>
  	<filter-name>encodingFilter</filter-name>
  	<filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
  	<init-param>
  		<param-name>encoding</param-name>
  		<param-value>UTF-8</param-value>
  	</init-param>
  </filter>

  <filter-mapping>
  	<filter-name>encodingFilter</filter-name>
	<url-pattern>/*</url-pattern>  
  </filter-mapping>
  
  <welcome-file-list>
    <welcome-file>index.html</welcome-file>
    <welcome-file>index.htm</welcome-file>
    <welcome-file>index.jsp</welcome-file>
    <welcome-file>default.html</welcome-file>
    <welcome-file>default.htm</welcome-file>
    <welcome-file>default.jsp</welcome-file>
  </welcome-file-list>
</web-app>
```

<br><br>

# 2. Spring DB
* spring은 미리 컨테이너가 필요한 객체를 만들어놓고 필요한 객체를 주입하는 방식을 사용한다.
* SQL Session팩토리 객체 -> SQL Session Templates객체 생성

## 2-1. 환경설정
1. DriverManager를 이용하여 DataSource 설정하는 방법
2. 커넥션 풀을 이용한 data source 설정하는 방법 : `DBCP API를 이용한 설정`
  - IO를 사용하면 DB 열고 닫는데 시간 오래걸림
3. 인터페이스를 이용하는 방법

* DAO 에서 SQL Session을 얻기 위해 XML 문서에 SqlSessionTemplate를 선언
* 필요 라이브러리
  - commons-dbcp
  - ojdbc8
  - spring-jdbc
  - MyBatis
  - MyBatis spring

<br>

### 01) commons-dbcp, ojdbc8 추가
* pom.xml

```xml
<!-- https://mvnrepository.com/artifact/commons-dbcp/commons-dbcp -->
<dependency>
    <groupId>commons-dbcp</groupId>
    <artifactId>commons-dbcp</artifactId>
    <version>1.4</version>
</dependency>


<!-- https://mvnrepository.com/artifact/com.oracle.database.jdbc/ojdbc8 -->
<dependency>
    <groupId>com.oracle.database.jdbc</groupId>
    <artifactId>ojdbc8</artifactId>
    <version>21.1.0.0</version>
</dependency>

<!-- https://mvnrepository.com/artifact/org.springframework/spring-jdbc -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.3.9</version>
</dependency>


```


### 02) DataSource설정
* config/spring/spring-mvc.xml


```xml
<!-- DataSource설정 -->
<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close">
  <property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"/>
  <property name="url" value="jdbc:oracle:thin:@localhost:xe"/>
  <property name="username" value="hr"/>
  <property name="password" value="hr"/>
</bean>
```

#### 잘 연결되었나 확인하기
* 내가 만든 메소드가 잘 실행되는지 확인해보고 싶을 때 수행하는 것이 단위테스트 (JUnit)
* 필요 라이브러리를 **pom.xml** 에 붙여넣는다.
  - JUnit
  - Spring test

```xml
<!-- https://mvnrepository.com/artifact/junit/junit -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>

<!-- https://mvnrepository.com/artifact/org.springframework/spring-test -->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-test</artifactId>
    <version>5.3.9</version>
    <scope>test</scope>
</dependency>
```

<br>

* src/test/java에 class 만들기
  - kr.ac.kopo -> `MybatisTest.java`생성

```java
package kr.ac.kopo;

import static org.junit.Assert.assertNotNull;
import javax.sql.DataSource;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.test.context.ContextConfiguration;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;

@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations= {"classpath:config/spring/spring-mvc.xml"})
public class MybatisTest {
	
	@Autowired
	private DataSource dataSource;
	
	@Test // Test실행시 사용하는 메소드
	public void DataSourceTest() throws Exception{
		System.out.println("dataSource : " + dataSource);
    //또는
    assertNotNull(dataSource);//올바르게 주입되었는지 확인.
	}

}
```

* Junit 실행하면 dataSource가 나옴.


### 03) MyBatis, MyBatis Spring 추가
* pom.xml

```xml
<!-- https://mvnrepository.com/artifact/org.mybatis/mybatis -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis</artifactId>
    <version>3.5.7</version>
</dependency>

<!-- https://mvnrepository.com/artifact/org.mybatis/mybatis-spring -->
<dependency>
    <groupId>org.mybatis</groupId>
    <artifactId>mybatis-spring</artifactId>
    <version>2.0.6</version>
</dependency>
```

### 04) Sql Session Factory 연결
* `src/main/resources`에 `mybatis` 폴더생성 후 `sqlMapConfig.xml` 생성

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE configuration
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>

</configuration>
```

* `config/spring/spring-mvc.xml`에  `sqlSessionFactory` , `sqlSessionTemplate`추가

```xml
<bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="configLocation" value="classpath:config/mybatis/sqlMapConfig.xml" />
</bean>

<bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate">
  <constructor-arg ref="sqlSessionFactory" />
</bean>
```






























